# Userflow: 대학교 데이터 시각화 대시보드

## 기능 목록

1. 회원가입
2. 로그인
3. 로그아웃
4. 메인 대시보드 조회
5. 실적 분석 조회
6. 논문 분석 조회
7. 학생 분석 조회
8. 예산 분석 조회
9. 엑셀 데이터 업로드
10. 업로드 히스토리 조회
11. 대시보드 데이터 필터링
12. 사용자 프로필 확인

---

## 1. 회원가입

### 입력
- 페이지 접근: 회원가입 페이지 URL 접속
- 이메일 주소 입력
- 비밀번호 입력
- 비밀번호 확인 입력
- 이름 입력 (선택사항)
- 회원가입 버튼 클릭

### 처리
1. 클라이언트에서 입력값 유효성 검증
   - 이메일 형식 검증
   - 비밀번호 길이 및 복잡도 검증
   - 비밀번호 일치 여부 검증
2. Clerk API로 회원가입 요청 전송
3. Clerk에서 사용자 계정 생성
4. 이메일 인증 링크 발송
5. 사용자가 이메일 인증 링크 클릭
6. Clerk에서 이메일 인증 완료 처리
7. Clerk Webhook을 통해 백엔드로 user.created 이벤트 전송
8. 백엔드에서 사용자 정보를 데이터베이스에 저장
9. 기본 사용자 권한 설정 (일반 사용자)

### 출력
- **성공 시**:
  - 이메일 인증 안내 메시지 표시
  - 인증 완료 후 로그인 페이지로 자동 리다이렉트
- **실패 시**:
  - 입력값 오류 메시지 표시 (이메일 형식, 비밀번호 불일치 등)
  - 이미 존재하는 이메일인 경우 안내 메시지 표시
  - 네트워크 오류 시 재시도 안내 메시지 표시

### 엣지케이스
- 이미 가입된 이메일로 재가입 시도: 기존 계정 존재 알림, 로그인 페이지로 안내
- 이메일 인증을 완료하지 않은 상태에서 로그인 시도: 인증 대기 메시지 표시, 인증 이메일 재발송 옵션 제공
- Webhook 전송 실패: 백엔드에서 사용자 데이터 누락, 재시도 로직 또는 수동 동기화 필요
- 네트워크 연결 끊김: 요청 타임아웃 처리, 재시도 안내

---

## 2. 로그인

### 입력
- 페이지 접근: 로그인 페이지 URL 접속
- 이메일 주소 입력
- 비밀번호 입력
- 로그인 버튼 클릭

### 처리
1. 클라이언트에서 입력값 유효성 검증
2. Clerk API로 로그인 요청 전송
3. Clerk에서 인증 정보 검증
4. 세션 생성 및 JWT 토큰 발급
5. 클라이언트에서 토큰을 안전하게 저장
6. 사용자 정보 및 권한 조회
7. 대시보드 홈 페이지로 리다이렉트

### 출력
- **성공 시**:
  - 대시보드 홈 페이지로 이동
  - 사용자 정보 표시 (헤더 영역)
- **실패 시**:
  - 잘못된 이메일 또는 비밀번호 오류 메시지 표시
  - 이메일 미인증 계정인 경우 인증 안내 메시지 표시
  - 계정 잠김 상태인 경우 안내 메시지 표시
  - 네트워크 오류 시 재시도 안내 메시지 표시

### 엣지케이스
- 이메일 인증이 완료되지 않은 계정: 인증 대기 메시지, 인증 이메일 재발송 옵션
- 잘못된 비밀번호 여러 번 입력: 계정 일시 잠금, 비밀번호 재설정 안내
- 만료된 세션으로 접근 시도: 자동 로그아웃 후 로그인 페이지로 리다이렉트
- 다른 기기에서 동시 로그인: 세션 유지 또는 기존 세션 종료 정책 적용

---

## 3. 로그아웃

### 입력
- 헤더 영역의 사용자 메뉴 클릭
- 로그아웃 버튼 클릭

### 처리
1. 클라이언트에서 Clerk 로그아웃 함수 호출
2. Clerk에서 세션 무효화
3. 클라이언트에서 로컬 저장된 토큰 삭제
4. 전역 상태 초기화
5. 로그인 페이지로 리다이렉트

### 출력
- **성공 시**:
  - 로그인 페이지로 이동
  - 로그아웃 성공 메시지 표시 (선택사항)
- **실패 시**:
  - 네트워크 오류 시에도 로컬 토큰 삭제 및 로그인 페이지로 이동

### 엣지케이스
- 네트워크 연결 끊김 상태에서 로그아웃: 로컬 데이터 삭제 후 로그인 페이지로 이동
- 이미 만료된 세션에서 로그아웃: 정상 처리, 로그인 페이지로 이동

---

## 4. 메인 대시보드 조회

### 입력
- 로그인 완료 후 자동 리다이렉트 또는 대시보드 메뉴 클릭
- 페이지 로드

### 처리
1. 인증 상태 확인 (JWT 토큰 검증)
2. 백엔드 API에 대시보드 데이터 요청
   - 인증 헤더에 JWT 토큰 포함
3. 백엔드에서 토큰 검증
4. 데이터베이스에서 최신 KPI 데이터 조회
   - 총 실적
   - 논문 게재 수
   - 학생 수
   - 예산 현황
5. 데이터베이스에서 차트 데이터 조회
   - 기간별 추이 데이터
   - 부서별 성과 데이터
   - 예산 배분 데이터
6. 데이터 포맷 변환 및 응답
7. 클라이언트에서 데이터 수신
8. KPI 카드 렌더링
9. 차트 라이브러리를 사용하여 그래프 렌더링
   - 라인 차트
   - 막대 그래프
   - 파이 차트

### 출력
- **성공 시**:
  - 주요 KPI 카드 4개 표시
  - 기간별 추이 라인 차트 표시
  - 부서별 성과 막대 그래프 표시
  - 예산 배분 파이 차트 표시
  - 로딩 완료 상태
- **실패 시**:
  - 데이터 없음 메시지 표시 (초기 상태)
  - 네트워크 오류 시 재시도 버튼 표시
  - 토큰 만료 시 로그인 페이지로 리다이렉트
  - 권한 오류 시 접근 불가 메시지 표시

### 엣지케이스
- 데이터베이스에 데이터가 없는 경우: 빈 상태 메시지 및 데이터 업로드 안내
- 대용량 데이터로 인한 느린 로딩: 로딩 인디케이터 표시, 스켈레톤 UI 적용
- 차트 렌더링 오류: 오류 메시지 표시, 데이터 테이블로 대체 표시
- 만료된 토큰으로 접근: 자동 로그아웃 후 로그인 페이지로 리다이렉트
- API 서버 다운: 오류 페이지 표시, 관리자에게 알림

---

## 5. 실적 분석 조회

### 입력
- 사이드바 또는 내비게이션에서 실적 분석 메뉴 클릭
- 페이지 로드
- 기간 필터 선택 (선택사항)
- 부서 필터 선택 (선택사항)
- 프로젝트 필터 선택 (선택사항)

### 처리
1. 인증 상태 확인
2. 선택된 필터 파라미터와 함께 백엔드 API 요청
3. 백엔드에서 토큰 검증
4. 필터 조건에 따라 데이터베이스 쿼리 실행
   - 기간별 실적 추이 데이터
   - 부서별/프로젝트별 실적 비교 데이터
   - 목표 대비 달성률 데이터
5. 데이터 집계 및 계산
6. 응답 데이터 포맷팅
7. 클라이언트에서 데이터 수신
8. 차트 및 테이블 렌더링

### 출력
- **성공 시**:
  - 기간별 실적 추이 라인 차트 표시
  - 부서별/프로젝트별 비교 막대 그래프 표시
  - 목표 대비 달성률 게이지 차트 또는 프로그레스 바 표시
  - 필터 적용 상태 표시
- **실패 시**:
  - 데이터 없음 메시지 (필터 조건에 맞는 데이터 부재)
  - 네트워크 오류 시 재시도 버튼
  - 토큰 만료 시 로그인 페이지로 리다이렉트

### 엣지케이스
- 필터 조건에 맞는 데이터가 없는 경우: 빈 상태 메시지, 필터 초기화 옵션
- 잘못된 필터 조합: 유효성 검증 후 오류 메시지
- 대용량 데이터 조회: 페이지네이션 또는 로딩 인디케이터
- 차트 렌더링 실패: 데이터 테이블로 대체 표시

---

## 6. 논문 분석 조회

### 입력
- 사이드바에서 논문 분석 메뉴 클릭
- 페이지 로드
- 연도 필터 선택 (선택사항)
- 학술지 필터 선택 (선택사항)
- 분야 필터 선택 (선택사항)

### 처리
1. 인증 상태 확인
2. 선택된 필터 파라미터와 함께 백엔드 API 요청
3. 백엔드에서 토큰 검증
4. 필터 조건에 따라 데이터베이스 쿼리 실행
   - 연도별 논문 게재 수 데이터
   - 학술지별 분류 데이터
   - 분야별 논문 통계 데이터
5. 데이터 집계 및 계산
6. 응답 데이터 포맷팅
7. 클라이언트에서 데이터 수신
8. 차트 및 테이블 렌더링

### 출력
- **성공 시**:
  - 연도별 논문 게재 수 라인 차트 또는 막대 그래프 표시
  - 학술지별 분류 파이 차트 표시
  - 분야별 논문 통계 막대 그래프 표시
  - 필터 적용 상태 표시
- **실패 시**:
  - 데이터 없음 메시지
  - 네트워크 오류 시 재시도 버튼
  - 토큰 만료 시 로그인 페이지로 리다이렉트

### 엣지케이스
- 필터 조건에 맞는 데이터가 없는 경우: 빈 상태 메시지
- 특정 연도에 논문 게재가 없는 경우: 0으로 표시
- 차트 렌더링 실패: 데이터 테이블로 대체 표시

---

## 7. 학생 분석 조회

### 입력
- 사이드바에서 학생 분석 메뉴 클릭
- 페이지 로드
- 학과 필터 선택 (선택사항)
- 학년 필터 선택 (선택사항)
- 연도 필터 선택 (선택사항)

### 처리
1. 인증 상태 확인
2. 선택된 필터 파라미터와 함께 백엔드 API 요청
3. 백엔드에서 토큰 검증
4. 필터 조건에 따라 데이터베이스 쿼리 실행
   - 학과별 학생 수 데이터
   - 학년별 분포 데이터
   - 입학/졸업 추이 데이터
5. 데이터 집계 및 계산
6. 응답 데이터 포맷팅
7. 클라이언트에서 데이터 수신
8. 차트 및 테이블 렌더링

### 출력
- **성공 시**:
  - 학과별 학생 수 막대 그래프 표시
  - 학년별 분포 파이 차트 또는 도넛 차트 표시
  - 입학/졸업 추이 라인 차트 표시
  - 필터 적용 상태 표시
- **실패 시**:
  - 데이터 없음 메시지
  - 네트워크 오류 시 재시도 버튼
  - 토큰 만료 시 로그인 페이지로 리다이렉트

### 엣지케이스
- 필터 조건에 맞는 데이터가 없는 경우: 빈 상태 메시지
- 특정 학과에 학생이 없는 경우: 0으로 표시
- 차트 렌더링 실패: 데이터 테이블로 대체 표시

---

## 8. 예산 분석 조회

### 입력
- 사이드바에서 예산 분석 메뉴 클릭
- 페이지 로드
- 부서 필터 선택 (선택사항)
- 연도 필터 선택 (선택사항)
- 예산 항목 필터 선택 (선택사항)

### 처리
1. 인증 상태 확인
2. 선택된 필터 파라미터와 함께 백엔드 API 요청
3. 백엔드에서 토큰 검증
4. 필터 조건에 따라 데이터베이스 쿼리 실행
   - 부서별 예산 배분 데이터
   - 예산 집행 현황 데이터
   - 연도별 예산 추이 데이터
5. 데이터 집계 및 계산
   - 집행률 계산
   - 잔액 계산
6. 응답 데이터 포맷팅
7. 클라이언트에서 데이터 수신
8. 차트 및 테이블 렌더링

### 출력
- **성공 시**:
  - 부서별 예산 배분 파이 차트 또는 트리맵 표시
  - 예산 집행 현황 프로그레스 바 또는 게이지 차트 표시
  - 연도별 예산 추이 라인 차트 표시
  - 필터 적용 상태 표시
- **실패 시**:
  - 데이터 없음 메시지
  - 네트워크 오류 시 재시도 버튼
  - 토큰 만료 시 로그인 페이지로 리다이렉트

### 엣지케이스
- 필터 조건에 맞는 데이터가 없는 경우: 빈 상태 메시지
- 예산 집행률이 100%를 초과하는 경우: 경고 표시
- 차트 렌더링 실패: 데이터 테이블로 대체 표시

---

## 9. 엑셀 데이터 업로드

### 입력
- 사이드바에서 데이터 업로드 메뉴 클릭 (관리자만 접근 가능)
- 페이지 로드
- 파일 선택 버튼 클릭 또는 드래그 앤 드롭 영역에 파일 드롭
- 엑셀 파일 선택 (.xlsx, .xls)
- 업로드 버튼 클릭

### 처리
1. 인증 상태 및 관리자 권한 확인
2. 클라이언트에서 파일 유효성 검증
   - 파일 형식 확인 (.xlsx, .xls)
   - 파일 크기 확인 (최대 10MB)
3. FormData 객체 생성 및 파일 추가
4. 백엔드 API에 파일 업로드 요청
   - 인증 헤더에 JWT 토큰 포함
   - multipart/form-data 형식
5. 백엔드에서 토큰 및 권한 검증
6. 업로드된 파일 저장 (임시 저장소)
7. Pandas를 사용하여 엑셀 파일 파싱
   - 헤더 행 확인
   - 필수 컬럼 존재 여부 확인
   - 데이터 타입 검증
8. 데이터 유효성 검증
   - 필수 필드 확인
   - 데이터 형식 확인
   - 중복 데이터 확인
9. 검증 통과 시 데이터베이스에 저장
   - 트랜잭션 시작
   - 기존 데이터 백업 또는 버전 관리
   - 새 데이터 삽입 또는 업데이트
   - 트랜잭션 커밋
10. 업로드 이력 기록
    - 업로드 일시
    - 업로드한 사용자
    - 파일명
    - 처리 결과
11. 클라이언트에 응답 전송

### 출력
- **성공 시**:
  - 업로드 성공 메시지 표시
  - 처리된 데이터 건수 표시
  - 대시보드 자동 새로고침 또는 안내 메시지
  - 업로드 히스토리에 새 항목 추가
- **실패 시**:
  - 파일 형식 오류 메시지
  - 파일 크기 초과 오류 메시지
  - 데이터 유효성 검증 실패 메시지 (상세 오류 정보 포함)
  - 필수 컬럼 누락 오류 메시지
  - 데이터베이스 저장 실패 오류 메시지
  - 네트워크 오류 시 재시도 버튼
  - 권한 오류 시 접근 불가 메시지

### 엣지케이스
- 잘못된 파일 형식 업로드: 오류 메시지, 허용되는 형식 안내
- 빈 파일 업로드: 오류 메시지, 데이터가 없음을 알림
- 파일 크기 초과: 오류 메시지, 최대 크기 안내
- 필수 컬럼 누락: 오류 메시지, 필요한 컬럼 목록 제공
- 데이터 타입 불일치: 오류 메시지, 예상되는 형식 안내
- 중복 데이터 발견: 경고 메시지, 덮어쓰기 또는 건너뛰기 옵션 제공
- 대용량 파일로 인한 긴 처리 시간: 진행 상태 표시, 비동기 처리 및 완료 알림
- 업로드 중 네트워크 끊김: 재시도 로직, 부분 업로드 복구
- 동시 다중 업로드: 큐 처리 또는 동시 업로드 제한
- 데이터베이스 저장 중 오류: 트랜잭션 롤백, 이전 상태 복구

---

## 10. 업로드 히스토리 조회

### 입력
- 데이터 업로드 페이지에서 히스토리 탭 클릭
- 페이지 로드
- 페이지네이션 버튼 클릭 (선택사항)
- 검색 또는 필터 적용 (선택사항)

### 처리
1. 인증 상태 및 관리자 권한 확인
2. 백엔드 API에 히스토리 데이터 요청
   - 페이지 번호 파라미터
   - 정렬 조건 파라미터
3. 백엔드에서 토큰 및 권한 검증
4. 데이터베이스에서 업로드 이력 조회
   - 업로드 일시
   - 업로드한 사용자
   - 파일명
   - 처리 결과 (성공/실패)
   - 처리된 데이터 건수
5. 페이지네이션 적용
6. 응답 데이터 포맷팅
7. 클라이언트에서 데이터 수신
8. 테이블 형태로 렌더링

### 출력
- **성공 시**:
  - 업로드 이력 테이블 표시
    - 업로드 일시
    - 업로드한 사용자
    - 파일명
    - 처리 결과 (성공/실패 뱃지)
    - 처리된 데이터 건수
  - 페이지네이션 컨트롤 표시
- **실패 시**:
  - 데이터 없음 메시지 (업로드 이력 부재)
  - 네트워크 오류 시 재시도 버튼
  - 권한 오류 시 접근 불가 메시지

### 엣지케이스
- 업로드 이력이 없는 경우: 빈 상태 메시지
- 대량의 히스토리 데이터: 페이지네이션 또는 가상 스크롤
- 특정 파일 상세 정보 조회: 모달 또는 상세 페이지로 이동

---

## 11. 대시보드 데이터 필터링

### 입력
- 대시보드 또는 분석 페이지에서 필터 버튼 클릭
- 필터 패널 오픈
- 기간 선택 (시작일, 종료일)
- 부서 선택 (다중 선택 가능)
- 카테고리 선택 (다중 선택 가능)
- 적용 버튼 클릭

### 처리
1. 선택된 필터 조건 수집
2. 필터 조건 유효성 검증
   - 시작일이 종료일보다 앞선지 확인
   - 필수 필터 값 확인
3. 필터 파라미터와 함께 백엔드 API 요청
4. 백엔드에서 필터 조건을 쿼리 파라미터로 변환
5. 데이터베이스에서 필터링된 데이터 조회
6. 데이터 집계 및 계산
7. 응답 데이터 전송
8. 클라이언트에서 데이터 수신
9. 차트 및 테이블 업데이트

### 출력
- **성공 시**:
  - 필터링된 데이터로 차트 및 테이블 업데이트
  - 적용된 필터 조건 표시 (뱃지 또는 태그)
  - 필터 초기화 버튼 표시
- **실패 시**:
  - 필터 조건 오류 메시지 (날짜 범위 오류 등)
  - 데이터 없음 메시지 (필터 조건에 맞는 데이터 부재)
  - 네트워크 오류 시 재시도 버튼

### 엣지케이스
- 잘못된 날짜 범위 선택: 유효성 검증 오류 메시지
- 필터 조건에 맞는 데이터가 없는 경우: 빈 상태 메시지, 필터 초기화 제안
- 복잡한 다중 필터 조합: 서버 측 쿼리 최적화 필요
- 필터 적용 후 페이지 새로고침: URL 파라미터로 필터 상태 유지

---

## 12. 사용자 프로필 확인

### 입력
- 헤더 영역의 사용자 아바타 또는 이름 클릭
- 프로필 메뉴 드롭다운 오픈
- 프로필 보기 옵션 클릭

### 처리
1. 인증 상태 확인
2. Clerk에서 현재 로그인한 사용자 정보 조회
   - 이름
   - 이메일
   - 프로필 이미지
   - 계정 생성일
3. 백엔드 API에서 추가 사용자 정보 조회 (선택사항)
   - 사용자 권한
   - 마지막 로그인 일시
4. 데이터 병합 및 포맷팅
5. 프로필 모달 또는 페이지 렌더링

### 출력
- **성공 시**:
  - 사용자 프로필 정보 표시
    - 이름
    - 이메일
    - 프로필 이미지
    - 권한 (관리자/일반 사용자)
    - 계정 생성일
  - 프로필 편집 버튼 (Clerk UI로 연결)
  - 비밀번호 변경 버튼 (Clerk UI로 연결)
- **실패 시**:
  - 네트워크 오류 시 재시도 버튼
  - 토큰 만료 시 로그인 페이지로 리다이렉트

### 엣지케이스
- 프로필 이미지가 없는 경우: 기본 아바타 표시
- 프로필 정보 조회 실패: 기본 정보만 표시 (이메일, 이름)
- Clerk UI 연동 오류: 오류 메시지 표시, 새로고침 안내
